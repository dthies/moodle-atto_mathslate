YUI.add("moodle-atto_mathslate-editor",function(h,t){var l,c;M&&(M.atto_mathslate=M.atto_mathslate||{}),l=M&&M.atto_mathslate||{},c={TOOLBOX:"mathslate-toolbox",DRAGNODE:"mathslate-toolbox-drag",UNDO:"mathslate-undo-button",REDO:"mathslate-redo-button",CLEAR:"mathslate-clear-button",HELP:"mathslate-help-button"},l.Editor=function(t,e,a){var i,o,d,s,r,n,u=window.MathJax;a=a||{texInput:!0},(i=this).node=h.one(t),this.node.setHTML(M.util.get_string("nomathjax","atto_mathslate")),u.Hub.processSectionDelay=0,o=h.guid(),d=h.guid(),t=h.guid(),this.node.addClass(c.EDITOR),this.node.setHTML('<div id="'+o+'" class="'+c.TOOLBOX+'"><div style="background-color: white; color: green; height: 300px; line-height: 75px; font-size: 18px; text-align:center"><br />Mathslate Mathematics Editor<br />Version 1.1</div><script type="math/tex">\\quad<\/script><math> <mo> </mo></math></div><div id="'+t+'" ></div>'),s=new l.MathJaxEditor("#"+t),r={tools:[],Tool:function(t){this.id=h.guid(),this.json=JSON.stringify(t),this.HTMLsnippet=[["span",{id:this.id,title:function n(e){if("string"==typeof e)return e;if("undefined"==typeof e[1])return"";var o="";return"undefined"!=typeof e[1].tex?(e[1].tex.forEach(function(t){o+="string"==typeof t?t:n(e[2][t])}),o):"string"==typeof e[2]?e[2]:"undefined"==typeof e[2]?"":(e[2].forEach(function(t){o+=n(t)}),o)}(t)},[["math",{},[t]]]]],function o(e){Array.isArray(e[2])&&e[2].forEach(function(t){Array.isArray(t)?o(t):"[]"===t&&(e[2][e[2].indexOf(t)]=["mn",{},"[]"])})}(t),r.tools.push(this)},fillToolBox:function(t,e){var o,n={children:[]};return u.Hub.Register.StartupHook("TeX Jax Config",function(){a.texInput&&(u.Ajax.Require("[MathJax]/extensions/toMathML.js"),n.children.push({label:'<span title="TeX"><math><mi>T</mi><mspace width="-.14em"/><mpadded height="-.5ex" depth="+.5ex" voffset="-.5ex"><mrow class="MJX-TeXAtom-ORD"><mi>E</mi></mrow></mpadded><mspace width="-.115em" /> <mi>X</mi> </math></span>',content:"<span id='"+d+"'></span>"}))}),u.Hub.Register.StartupHook("End",function(){t.forEach(function(t){var e=h.Node.create("<p></p>");t.tools.forEach(function(t){t[0]&&"br"===t[0]?e.append("<br />"):(t=new r.Tool(t),e.append("<span> "+s.toMathML(t.HTMLsnippet)+" </span>"))}),n.children.push({label:t.label,content:e.getHTML()})}),o=new h.TabView(n),i.output=function(t){return s.output(t)},h.one("#"+e)&&(h.one("#"+e).setHTML(""),o.render("#"+e),h.one("#"+d)&&new l.TeXTool("#"+d,function(t){s.addMath(t)})),u.Hub.Queue(["Typeset",u.Hub,e]),u.Hub.Queue(function(){r.tools.forEach(function(t){h.one("#"+e)&&h.one("#"+e).one("#"+t.id)&&r.registerTool(t)})})}),o},getToolByID:function(e){var o;return this.tools.forEach(function(t){t.id&&t.id===e&&(o=t)}),o},registerTool:function(t){var e;h.one("#"+t.id)&&((e=new h.DD.Drag({node:"#"+t.id})).set("data",t.json),e.on("drag:start",function(){this.get("dragNode").addClass(c.DRAGNODE)}),e.on("drag:end",function(){this.get("node").setStyle("top","0"),this.get("node").setStyle("left","0"),this.get("node").removeClass(c.DRAGNODE)}))}},u.Hub.Queue(["Typeset",u.Hub,o]),h.on("io:success",function(t,e){n.id===t&&u.Hub.Queue(["fillToolBox",r,h.JSON.parse(e.response),o])}),n=e===undefined?h.io(l.config):h.io(e),this.tbox=r,(this.mje=s).canvas.on("drop:hit",function(t){t.drag.get("data")&&s.addMath(t.drag.get("data"))}),h.one("#"+o).delegate("click",function(){var t=r.getToolByID(this.getAttribute("id"));t&&s.addMath(t.json)},"span .yui3-dd-draggable")}},"@VERSION@",{requires:["dd-drag","dd-proxy","dd-drop","event","tabview","io-base","json","moodle-atto_mathslate-textool","moodle-atto_mathslate-mathjaxeditor"]});