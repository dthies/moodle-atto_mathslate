YUI.add("moodle-atto_mathslate-snippeteditor",function(r,t){M.atto_mathslate=M.atto_mathslate||{},(M&&M.atto_mathslate||{}).mSlots=function(){var i,o=[],s=0,e=[];function n(){var t,n;o.splice(s),t=e.slice(0),n=[],t.forEach(function(t){n.push(t.slice(0))}),o[s]=[t,n]}function t(){var t,i;e.splice(0),e[0]&&e.pop(),t=o[s][0],i=o[s][1],t.forEach(function(n,t){n.splice(0),n[0]&&n.pop(),i[t].forEach(function(t){n.push(t)}),e.push(n)})}this.slots=e,this.redo=function(){return o[s+1]?(s++,t(),this):this.next||this},this.undo=function(){return 0===s?this.previous||this:(0===--s?e[0].pop():t(),this)},this.createItem=function(t){var n;return n="MJX-"+r.Node.create("<span></span").generateID(),(t=r.JSON.parse(t))[1].id=n,function o(i){Array.isArray(i[2])&&i[2].forEach(function(t){var n;Array.isArray(t)?o(t):"[]"===t&&(n="MJX-"+r.guid(),e.push([["mo",{id:n,"class":"blank",tex:[""]},"◻"]]),i[2][i[2].indexOf(t)]=["mrow",{},e[e.length-1]])})}(t),t},this.getItemByID=function(n){var i;return this.slots.forEach(function(t){t.forEach(function(t){t[1].id===n&&(i=r.JSON.stringify(t))})}),i},this.isItem=function(n){var i=!1;return this.slots.forEach(function(t){i||t.forEach(function(t){t[1].id===n&&(i=!0)})}),i},this.removeSnippet=function(i){var o=0;return this.slots.forEach(function(n){n.forEach(function(t){t[1].id===i&&(o=t,n.splice(n.indexOf(t),1))})}),o},this.insertSnippet=function(i,o){var r=0;this.slots.forEach(function(n){n.forEach(function(t){0===r&&t[1].id===i&&(r=t,n.splice(n.indexOf(r),0,o))})}),s++,this.next=null,n()},this.append=function(t){e[0].push(t),s++,this.next=null,n()},this.forEach=function(i){this.slots.forEach(function(n){n.forEach(function(t){i(t,n)})})},this.rekey=function(){var i=this;this.slots.forEach(function(n){0===n.length?n.push(["mo",{id:"MJX-"+r.guid(),"class":"blank",tex:[""]},"◻"]):n.forEach(function(t){t[1]&&(t[1]["class"]&&"blank"===t[1]["class"]&&1<n.length&&i.removeSnippet(t[1].id),t[1].id&&(t[1].id="MJX-"+r.guid()))})})},this.output=function(r){var n="";return e[0].forEach(function(t){n+=function o(t){var n,i="";if("string"==typeof t)return t;if(t[1]&&t[1][r])for(n=0;t[1][r][n];)i+=t[1][r][n++],t[2]&&"number"==typeof t[1][r][n]&&(i+=o(t[2][t[1][r][n]])),n++;else t[2]&&("string"==typeof t[2]?i+=t[2]:t[2].forEach(function(t){i+=o(t)}));return i}(t)}),n},this.preview=function(r){var n="";return e[0].forEach(function(t){n+=function o(t){var n,i="";if("string"==typeof t)return t;if(t[1]&&t[1].id&&(i=i+'<div id="'+t[1].id+'">'),t[1]&&r&&t[1][r])for(n=0;t[1][r][n];)i+=t[1][r][n++],t[2]&&"number"==typeof t[1][r][n]&&(i+=o(t[2][t[1][r][n]])),n++;else t[2]&&("string"==typeof t[2]?r&&(i+=t[2]):t[2].forEach(function(t){i+=o(t)}));return t[1]&&t[1]["class"]&&"blank"===t[1]["class"]&&(i+="<br>"),t[1]&&t[1].id&&(i+="</div>"),i}(t)}),n},this.select=function(n){i=null,this.slots.forEach(function(t){t.forEach(function(t){t[1].id===n&&(i=t)})})},this.getSelected=function(){return i&&i[1].id}}},"@VERSION@",{requires:["json"]});